# This workflow uses actions that are not certified by GitHub.  
# They are provided by a third-party and are governed by  
# separate terms of service, privacy policy, and support  
# documentation.  

name: Login Test Cases  

on:  
  push:  
    branches: [ "main" ]  
  pull_request:  
    types: [opened, synchronize, reopened]  
  schedule:  
    - cron: "0 8 * * *"  

jobs:  
  build:  
    runs-on: ubuntu-latest  
    permissions:  
      contents: read  
    
    steps: 

    - uses: actions/checkout@v4  

    - name: Set up JDK 22  
      uses: actions/setup-java@v4  
      with:  
        java-version: '22'  
        distribution: 'temurin'  

    - name: Cache Gradle packages  
      uses: actions/cache@v4  
      with:  
        path: |  
          ~/.gradle/caches  
          ~/.gradle/wrapper  
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}  
        restore-keys: |  
          ${{ runner.os }}-gradle-  

    - name: Setup Gradle  
      uses: gradle/actions/setup-gradle@v3 

    - name: Set up Chrome Driver  
      run: |  
        sudo apt-get update  
        sudo apt-get install -y google-chrome-stable  
        CHROME_VERSION=$(google-chrome --version | cut -d' ' -f3)  
        echo "Chrome Version: $CHROME_VERSION"  
    
        # Construir la URL del ChromeDriver directamente  
        CHROMEDRIVER_VERSION=$(echo $CHROME_VERSION | sed 's/\.[0-9]*$//') # Obtener la version principal ej: 133.0.6943  
        CHROMEDRIVER_URL="https://chromedriver.storage.googleapis.com/${CHROMEDRIVER_VERSION}/chromedriver_linux64.zip"  
        echo "ChromeDriver URL: $CHROMEDRIVER_URL"  
        
        sudo mkdir -p /usr/local/share/chromedriver  
        wget "$CHROMEDRIVER_URL" -q -O /tmp/chromedriver_linux64.zip  
        unzip /tmp/chromedriver_linux64.zip -d /usr/local/share/chromedriver  
        chmod +x /usr/local/share/chromedriver/chromedriver  
        sudo ln -s /usr/local/share/chromedriver/chromedriver /usr/bin/chromedriver  
    - name: Build with Gradle Wrapper  
      run: ./gradlew build 

    - name: Run Tests  
      run: ./gradlew test --tests "src/test/java/runner/*.java"  

    - name: Run Checkstyle  
      run: ./gradlew checkstyleMain checkstyleTest  

    - name: Upload Checkstyle report  
      uses: actions/upload-artifact@v4  
      with:  
        name: checkstyle-report  
        path: build/reports/checkstyle  

  dependency-submission:  
    runs-on: ubuntu-latest  
    permissions:  
      contents: write  

    steps:  
    - uses: actions/checkout@v4  
    - name: Set up JDK 22 for Dependency Submission  
      uses: actions/setup-java@v4  
      with:  
        java-version: '22'  
        distribution: 'temurin'  
    - name: Generate and submit dependency graph  
      uses: gradle/actions/dependency-submission@af1da67850ed9a4cedd57bfd976089dd991e2582  